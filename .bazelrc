# Common flags for all commands
common --enable_platform_specific_config

# Android configuration
build:android --fat_apk_cpu=arm64-v8a,armeabi-v7a
build:android --android_crosstool_top=@androidndk//:toolchain
build:android --host_crosstool_top=@bazel_tools//tools/cpp:toolchain

# Java configuration - use local JDK 21
build --java_language_version=17
build --tool_java_language_version=17
build --java_runtime_version=local_jdk
build --tool_java_runtime_version=local_jdk

# Kotlin configuration
build --strategy=KotlinCompile=worker
# Disable worker sandboxing to avoid Java version issues
build --worker_sandboxing=false

# Performance optimizations
build --worker_max_instances=4
# Allow JAVA_HOME in action environment
build --action_env=JAVA_HOME

# Output configuration
build --verbose_failures
build --show_timestamps

# Test configuration
test --test_output=errors
test --test_summary=detailed

# Cache configuration
build --disk_cache=~/.cache/bazel

# Incremental dexing
build --incremental_dexing

# Allow modern Android features
build --experimental_android_databinding_v2
build --experimental_android_resource_shrinking
